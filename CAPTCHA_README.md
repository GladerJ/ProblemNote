# 登录验证码功能说明

## 功能概述

为登录功能添加了随机数字验证码，有效防止频繁登录和暴力破解攻击。验证码采用4位数字格式，使用SVG图形显示，支持实时刷新。

## 技术实现

### 1. 验证码生成

**CaptchaUtil工具类**
- 生成4位随机数字验证码
- 使用SVG格式显示验证码图片
- 添加干扰线和随机效果（旋转、大小变化）

**核心方法**：
```java
// 生成验证码
public static String generateCaptcha()

// 验证验证码
public static boolean validateCaptcha(String inputCaptcha, String sessionCaptcha)

// 生成SVG图片
public static String generateCaptchaSVG(String captcha)
```

### 2. 控制器层

**UserController增强**：
- 登录页面自动生成验证码
- 登录验证时检查验证码
- 提供验证码刷新接口

**新增接口**：
```java
// 刷新验证码
@GetMapping("/captcha/refresh")
public String refreshCaptcha(HttpSession session)
```

### 3. 前端界面

**登录表单增强**：
- 添加验证码输入框
- 显示SVG格式验证码图片
- 提供刷新按钮

**交互功能**：
- 验证码输入框只允许数字
- 点击刷新按钮实时更新验证码
- 刷新按钮旋转动画效果

## 安全特性

### 1. 防暴力破解
- 每次登录失败都会重新生成验证码
- 验证码存储在服务器端Session中
- 登录成功后自动清除验证码

### 2. 用户体验
- 验证码清晰易读
- 支持一键刷新
- 输入框自动过滤非数字字符

### 3. 技术特点
- 使用SVG格式，无需额外图片文件
- 轻量级实现，性能优秀
- 响应式设计，适配各种设备

## 验证流程

### 1. 登录页面加载
1. 生成4位随机数字验证码
2. 将验证码存储在Session中
3. 生成SVG格式的验证码图片
4. 在页面中显示验证码

### 2. 用户登录
1. 用户输入用户名、密码和验证码
2. 后端验证验证码是否正确
3. 验证码错误：返回错误信息，重新生成验证码
4. 验证码正确：继续验证用户名和密码
5. 登录成功：清除Session中的验证码

### 3. 验证码刷新
1. 用户点击刷新按钮
2. 发送AJAX请求到`/captcha/refresh`
3. 服务器生成新的验证码
4. 返回新的SVG图片
5. 前端更新验证码显示

## 界面设计

### 1. 验证码组件布局
```
[验证码输入框] [验证码图片] [刷新按钮]
```

### 2. 样式特点
- 验证码输入框：限制宽度，只允许数字
- 验证码图片：SVG格式，带干扰线
- 刷新按钮：圆形图标，悬停效果

### 3. 响应式设计
- 桌面端：水平布局
- 移动端：垂直布局（可选）

## 配置参数

### 1. 验证码设置
```java
private static final String NUMBERS = "0123456789";  // 数字字符集
private static final int CAPTCHA_LENGTH = 4;         // 验证码长度
```

### 2. SVG图片设置
```java
width: 120px, height: 40px  // 图片尺寸
fontSize: 14-18px           // 字体大小范围
rotation: -10° to +10°      // 旋转角度范围
```

## 使用方式

### 1. 正常登录
1. 访问登录页面，自动显示验证码
2. 输入用户名、密码和验证码
3. 点击登录按钮

### 2. 验证码刷新
1. 点击验证码旁边的刷新按钮
2. 验证码图片自动更新
3. 输入新的验证码

### 3. 错误处理
- 验证码错误：显示"验证码错误"提示
- 用户名密码错误：显示"用户名或密码错误"提示
- 每次错误后都会重新生成验证码

## 扩展功能

### 1. 可配置选项
- 验证码长度（当前4位）
- 字符集（当前仅数字）
- 图片样式（颜色、字体、干扰线）

### 2. 高级安全
- 验证码有效期限制
- 登录失败次数限制
- IP地址限制

### 3. 用户体验
- 语音验证码
- 滑动验证码
- 图形验证码

## 注意事项

1. **Session管理**：验证码存储在Session中，确保Session配置正确
2. **字符编码**：SVG输出使用UTF-8编码
3. **浏览器兼容**：SVG格式需要现代浏览器支持
4. **性能考虑**：验证码生成是轻量级操作，不会影响性能

## 测试建议

1. **功能测试**：
   - 正确验证码登录
   - 错误验证码登录
   - 验证码刷新功能
   - 输入框字符过滤

2. **安全测试**：
   - 暴力破解防护
   - Session安全
   - XSS防护

3. **兼容性测试**：
   - 不同浏览器
   - 移动设备
   - 不同屏幕尺寸 